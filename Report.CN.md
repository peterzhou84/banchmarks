# 基本描述

为了测试不同的程序开发语言之间的性能差异，我们设计了如下几个场景：

1. 直接返回'hello world'
2. 从本地读取文件的内容之后，返回
3. 从Mysql里面读取内容之后，返回
4. 从Redis里面读取内容之后，返回

性能测试在两台云主机上，采用JMeter进行压测。

应用被部署到应用服务器，JMeter则部署在测试服务器。

两台主机都是公有云上面的双核4G内存的标准主机。

# 性能测试数据结果

![](http://otn252ndm.bkt.clouddn.com/17-9-18/68105195.jpg)

第一列是场景名称，由`{程序语言名称}_{并发用户数}_{功能场景ID}`组成。


# 总结

1. 系统的吞吐能力，go语言比nodejs大了将近3倍。
2. 随着并发量的增加，go和node的吞吐能力都有所下降。NodeJS相对平稳一些。
3. 在400并发的情况下，Nodejs出现了长达15s的超长延迟情况，在500并发下，最长的请求是7s。这说明，nodejs的单点处理并发的能力，并没有go稳定。
4. 在引入了mysql（场景3）和redis（场景4）的情况下，系统吞吐量剧烈下降，这个应该是受到mysql和redis本身处理能力的限制。相比之下，仍然是go表现更加稳定和高效。

另外，在比较[PHP的性能数据](https://github.com/kenjis/php-framework-benchmark)之后，Nodejs的吞吐量是PHPsiler的2.55倍，是Yii2的12.89倍。如果去掉PHP模板引擎逻辑，应该会快些，但是还是差距很大。

# 分析

在测试执行的过程中，CPU使用率两边都差不多是50%左右。不同的是，Go语言程序在执行的时候内核态的cpu使用率达到了16%，而nodejs一直是5%左右。我认为Go语言从内核的角度对代码进行了深入优化，而Nodejs一直是专注于用户态的优化的。

在比较了不同语言在不同的操作的情况下的性能数据比较之后，发现Go和Nodejs应该说各有千秋。Nodejs在处理Base64变化和JSON格式的数据的时候，效率比Go更高。而Go在矩阵计算等重计算的操作中胜出。原始性能测试数据[请参见这里](https://github.com/kostya/benchmarks)。

另外，从工程化实施的角度看，Nodejs提供了完整的私有库支持，并能够非常容易的管理不同项目之间的依赖关系。

Go语言的项目也可以通过私有git库来进行存储，项目之间的依赖关系管理也是比较简单点。

考虑到在用gitlab管理企业内部的私有git库的情况下，gitlab本身提供的非常丰富的权限管理能力，Go项目的项目依赖关系可以做到非常灵活。比如，你可以限定某些项目可以被特定的用户组访问，或者定义成只有登录用户访问，甚至开放给所有人都可以访问。

而用sinopia管理的Nodejs私有库就没有那么灵活了，因为sinopia的权限管理可以控制到某人用户可以访问到某个项目目录，但是，没有办法根据用户分组来控制权限。并且，sinopia是通过配置文件来进行配置的，从可用性角度来说，还是略逊一筹的。

综上所述，对于大型企业来说，Go还是一个更好的选择。

# Go它话

Go语言虽然有非常多的优点，但是因为这种库定义的灵活性，导致go的开源库非常杂。在使用的过程中，需要仔细选型，防止开源库大坑。我在写mysql部分的示例代码的时候，首先引用的一个库就会内部报越界的错误，虽然不影响最终结果，但是我还是弃用了。

Nodejs因为有npm统一管理库，因此在这方面相对来说还是好点的。